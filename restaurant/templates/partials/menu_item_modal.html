{% load static %}

{% with ctx=ctx|default:"menu" %}
<div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8">

  <!-- Image -->
  <div class="relative">
    <div class="absolute -inset-3 bg-[#bfa76f]/10 blur-2xl rounded-[22px]"></div>

    <div class="relative overflow-hidden rounded-2xl border border-[#3e2723]/10 bg-white shadow-sm">
      <div class="relative">
        {% if item.image %}
          <img src="{{ item.image.url }}" alt="{{ item.name }}" class="w-full h-72 md:h-[360px] object-cover">
        {% else %}
          <div class="w-full h-72 md:h-[360px] bg-[#f5f0e6] flex items-center justify-center text-[#3e2723]/60 text-sm">
            No image
          </div>
        {% endif %}

        <!-- soft vignette -->
        <div class="pointer-events-none absolute inset-0 bg-gradient-to-t from-black/35 via-black/10 to-transparent"></div>

        <!-- status badge -->
        {% if item.status == "sold_out" %}
          <div class="absolute left-4 top-4 inline-flex items-center gap-2 px-3 py-1.5 rounded-full
                      bg-red-600/15 text-red-800 border border-red-600/25 backdrop-blur text-[11px] font-semibold uppercase tracking-[0.22em]">
            Sold out
          </div>
        {% else %}
          <div class="absolute left-4 top-4 inline-flex items-center gap-2 px-3 py-1.5 rounded-full
                      bg-white/15 text-white border border-white/20 backdrop-blur text-[11px] font-semibold uppercase tracking-[0.22em]">
            Available
          </div>
        {% endif %}

        <!-- item discount badge (if your model provides discount_percentage) -->
        {% if item.discount_percentage %}
          <div class="absolute right-4 top-4 inline-flex items-center px-3 py-1.5 rounded-full
                      bg-red-600 text-white text-[11px] font-bold shadow-md">
            -{{ item.discount_percentage }}%
          </div>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Details -->
  <div class="flex flex-col">

    <!-- Title + category -->
    <div class="min-w-0">
      <h2 class="text-2xl md:text-3xl font-semibold text-[#3e2723] leading-tight">
        {{ item.name }}
      </h2>

      {% if item.category %}
        <div class="mt-2 flex items-center gap-3">
          <div class="h-px w-10 bg-[#bfa76f]/70"></div>
          <div class="text-[11px] uppercase tracking-[0.28em] text-[#3e2723]/60">
            {{ item.category.name }}
          </div>
        </div>
      {% endif %}
    </div>

    <!-- Price -->
    <div class="mt-4 rounded-2xl border border-[#3e2723]/10 bg-white/70 p-4">
      <div class="text-[11px] uppercase tracking-[0.25em] text-[#3e2723]/55 mb-1">
        Price
      </div>

      {% if item.discount_price %}
        <div class="flex items-end gap-3 flex-wrap">
          <div class="text-[#3e2723]/45 line-through font-semibold">
            € {{ item.price }}
          </div>
          <div class="text-red-600 text-2xl font-bold">
            € {{ item.discount_price }}
          </div>
        </div>
        <div class="mt-1 text-[11px] text-[#3e2723]/55">
          Discount applied on this item.
        </div>
      {% else %}
        <div class="text-[#3e2723] text-2xl font-bold">
          € {{ item.price }}
        </div>
        <div class="mt-1 text-[11px] text-[#3e2723]/55">
          Final discount (coupon/promo) is calculated in the cart.
        </div>
      {% endif %}
    </div>

    <!-- Description -->
    {% if item.description %}
      <div class="mt-4 text-sm text-[#3e2723]/75 leading-relaxed">
        {{ item.description }}
      </div>
    {% endif %}

    <!-- Divider -->
    <div class="mt-6 h-px bg-[#3e2723]/10"></div>

    <!-- Actions -->
      <div class="mt-5 space-y-3">

        <!-- Qty controls (hidden until item is in cart) -->
        <div id="modalQtyControls"
            class="hidden rounded-2xl border border-[#3e2723]/10 bg-white/70 p-4">

          <div class="flex items-center justify-between gap-3">
            <div class="text-sm font-semibold text-[#3e2723]">In your cart</div>

            <button type="button"
                    id="modalRemoveBtn"
                    class="text-xs font-semibold text-red-600 hover:underline underline-offset-4">
              Remove
            </button>
          </div>

          <div class="mt-3 flex items-center gap-3">
            <button type="button"
                    id="modalMinusBtn"
                    class="h-10 w-10 rounded-xl bg-[#f5f0e6] border border-[#3e2723]/10 text-[#3e2723] font-bold active:scale-95 transition">
              −
            </button>

            <div class="min-w-[44px] text-center">
              <div class="text-[11px] uppercase tracking-wider text-[#3e2723]/55">Qty</div>
              <div id="modalQtyValue" class="text-lg font-bold text-[#3e2723]">0</div>
            </div>

            <button type="button"
                    id="modalPlusBtn"
                    class="h-10 w-10 rounded-xl bg-[#f5f0e6] border border-[#3e2723]/10 text-[#3e2723] font-bold active:scale-95 transition">
              +
            </button>
          </div>
        </div>

        <!-- Add button (shown when not in cart) -->
        <button
          type="button"
          id="modalAddBtn"
          data-add-delivery="{{ item.id }}"
          class="w-full rounded-xl px-5 py-3 font-semibold shadow-sm transition
                bg-[#bfa76f] text-[#2a1a14] border border-[#3e2723]/10 hover:brightness-95 active:scale-[0.99]
                {% if item.status == 'sold_out' %}opacity-40 cursor-not-allowed hover:brightness-100 active:scale-100{% endif %}"
          {% if item.status == "sold_out" %}disabled{% endif %}
        >
          Add to Cart
        </button>

        <!-- Checkout -->
        <button
          type="button"
          data-open-checkout
          class="w-full block rounded-xl px-5 py-3 font-semibold text-center transition
                bg-[#3e2723] text-white border border-white/10 hover:opacity-95 active:scale-[0.99]">
          Checkout →
        </button>



      <!-- Helps JS know current item -->
      <div id="modalItemMeta"
          data-item-id="{{ item.id }}"
          class="hidden"></div>


    <!-- Tip -->
    <div class="mt-4 text-[11px] text-[#3e2723]/55 leading-relaxed">
      Tip: Tap <b>Add to Cart</b>, then use the cart on the right (desktop) or bottom bar (mobile) to finish checkout.
    </div>

  </div>
</div>
{% endwith %}
