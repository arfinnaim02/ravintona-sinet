{% load static i18n l10n %}

<div class="bg-[#f5f0e6]">
  <div class="p-5 sm:p-7">
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">

      <!-- LEFT -->
      <div class="lg:col-span-7 space-y-4">

        <!-- Title -->
        <div class="flex items-start justify-between gap-4">
          <div>
            <div class="brand-serif text-2xl font-semibold text-[#3e2723]">
              {% trans "Confirm delivery location" %}
            </div>
            <div class="text-sm text-[#3e2723]/70 mt-1">
              {% trans "Search your address or drag the pin to your entrance." %}
            </div>
          </div>

          <div class="flex flex-col items-end gap-2">
            <button id="dlUseMyLocation"
                    type="button"
                    class="px-4 py-2 rounded-xl font-semibold text-sm text-white
                           bg-[#3e2723] shadow-sm hover:shadow-md hover:brightness-105 active:scale-[0.99] transition">
              {% trans "Use my location →" %}
            </button>
            <div class="text-[11px] text-[#3e2723]/60">
              {% trans "Status:" %} <span id="dlGpsStatus" class="font-semibold">{% trans "Idle" %}</span>
            </div>
          </div>
        </div>

        <!-- Search -->
        <div class="rounded-2xl border border-[#3e2723]/10 bg-white/80 shadow-sm p-4">
          <label class="block text-xs uppercase tracking-wider text-[#3e2723]/60 mb-2">
            {% trans "Search address" %}
          </label>

          <input id="dlAddrSearch"
                 type="text"
                 autocomplete="off"
                 placeholder="{% trans "Start typing… e.g., Kauppakatu 10, Joensuu" %}"
                 class="w-full px-4 py-3 rounded-xl border border-[#3e2723]/15 bg-white outline-none
                        focus:border-[#bfa76f] focus:ring-2 focus:ring-[#bfa76f]/20">

          <div class="mt-2 text-[11px] text-[#3e2723]/55">
            {% blocktrans %}Tip: pick a suggestion from the dropdown for best accuracy.{% endblocktrans %}
          </div>
        </div>

        <!-- Map card -->
        <div class="rounded-2xl border border-[#3e2723]/10 bg-white shadow-sm overflow-hidden">
          <div class="relative">
            <!-- responsive height: smaller on mobile so button is reachable -->
            <div id="dlMap"
            data-rest-lat="{{ rest_lat|floatformat:6 }}"
            data-rest-lng="{{ rest_lng|floatformat:6 }}"
            class="w-full h-[280px] sm:h-[360px]"></div>


            <div class="absolute top-3 left-3 z-[10]">
              <div class="px-3 py-2 rounded-xl bg-white/90 border border-[#3e2723]/10 text-xs text-[#3e2723] shadow-sm backdrop-blur">
                <div class="font-semibold">{% trans "Drag pin to entrance" %}</div>
                <div class="mt-0.5 text-[#3e2723]/60">
                  {% trans "Accuracy:" %} <span id="dlAccText" class="font-semibold">—</span>
                </div>
              </div>
            </div>
          </div>

          <div class="p-4 border-t border-[#3e2723]/10 bg-white/70">
            <div class="text-xs uppercase tracking-wider text-[#3e2723]/60">
              {% trans "Selected address" %}
            </div>
            <div id="dlAddrLabel" class="mt-1 text-sm font-semibold text-[#3e2723]">—</div>
            <div class="mt-1 text-[11px] text-[#3e2723]/55">
              {% blocktrans %}Delivery radius: <b>{{ max_radius }} km</b>.{% endblocktrans %}
            </div>
          </div>
        </div>

        <!-- Sticky confirm bar (always visible) -->
        <div class="sticky bottom-0 z-10 -mx-5 sm:-mx-7 px-5 sm:px-7 pb-5 pt-4 bg-gradient-to-t from-[#f5f0e6] via-[#f5f0e6] to-transparent">
          <div class="rounded-2xl border border-[#3e2723]/10 bg-white/85 backdrop-blur shadow-sm p-4">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
              <button id="dlConfirmBtn"
                      type="button"
                      class="px-7 py-3 rounded-xl font-semibold text-[#2a1a14]
                             bg-[#bfa76f] shadow-sm hover:brightness-95 active:scale-[0.99] transition
                             opacity-50 cursor-not-allowed w-full sm:w-auto">
                {% trans "Confirm & Continue →" %}
              </button>

              <div id="dlConfirmHint" class="text-[11px] text-[#3e2723]/60">
                {% trans "Select an address or drag the pin, then confirm." %}
              </div>
            </div>

            <!-- hidden payload -->
            <input type="hidden" id="dlLat">
            <input type="hidden" id="dlLng">
            <input type="hidden" id="dlLabelHidden">
          </div>
        </div>

      </div>

      <!-- RIGHT -->
      <div class="lg:col-span-5">
        <div class="rounded-3xl overflow-hidden shadow-xl border border-white/10 bg-[#2a1712] relative">
          <div class="p-6">
            <div class="brand-serif text-2xl font-semibold text-white mb-4">
              {% trans "Delivery Estimate" %}
            </div>

            <div class="p-4 rounded-2xl bg-white/5 border border-white/10 space-y-3 text-sm">
              <div class="flex justify-between">
                <div class="text-white/70">{% trans "Distance" %}</div>
                <div class="font-semibold text-white" id="dlDistanceText">—</div>
              </div>

              <div class="flex justify-between">
                <div class="text-white/70">{% trans "Delivery fee" %}</div>
                <div class="font-semibold text-white" id="dlFeeText">—</div>
              </div>

              <div class="h-px bg-white/10 my-2"></div>

              <div class="flex justify-between">
                <div class="text-white/70">{% trans "Estimated total" %}</div>
                <div class="font-semibold text-white" id="dlTotalText">—</div>
              </div>

              <div id="dlRangeWarn"
                   class="hidden mt-3 p-3 rounded-2xl bg-red-500/15 border border-red-400/20 text-[12px] text-white/90">
                {% trans "Outside delivery range. Please move the pin closer." %}
              </div>
            </div>

            <div class="mt-4 text-[11px] text-white/55">
              {% trans "You can still scroll this modal; the confirm button stays visible." %}
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
