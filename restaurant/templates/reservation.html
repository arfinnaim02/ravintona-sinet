{% extends "base.html" %}
{% load static %}
{% load i18n %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/reservation.css' %}">
{% endblock %}

{% block content %}
<section class="bg-[#f5f0e6]">
  <div class="max-w-6xl mx-auto px-4 py-8 sm:py-10">

    {# ===== Top feature cards ===== #}
    <div class="hidden md:grid grid-cols-1 md:grid-cols-3 gap-3 sm:gap-4 mb-6">
      <div class="rounded-2xl border border-[#3e2723]/10 bg-white/70 backdrop-blur p-4 shadow-sm">
        <div class="text-[11px] uppercase tracking-[0.3em] text-[#3e2723]/55">{% trans "Fast" %}</div>
        <div class="text-lg font-semibold text-[#3e2723] mt-1">{% trans "Smart availability" %}</div>
        <div class="text-sm text-[#3e2723]/65 mt-1">{% trans "Slots are validated automatically on submit." %}</div>
      </div>
      <div class="rounded-2xl border border-[#3e2723]/10 bg-white/70 backdrop-blur p-4 shadow-sm">
        <div class="text-[11px] uppercase tracking-[0.3em] text-[#3e2723]/55">{% trans "Comfort" %}</div>
        <div class="text-lg font-semibold text-[#3e2723] mt-1">{% trans "Baby seats supported" %}</div>
        <div class="text-sm text-[#3e2723]/65 mt-1">{% trans "Add baby seats if you need them." %}</div>
      </div>
      <div class="rounded-2xl border border-[#3e2723]/10 bg-white/70 backdrop-blur p-4 shadow-sm">
        <div class="text-[11px] uppercase tracking-[0.3em] text-[#3e2723]/55">{% trans "Bonus" %}</div>
        <div class="text-lg font-semibold text-[#3e2723] mt-1">{% trans "Pre-order food" %}</div>
        <div class="text-sm text-[#3e2723]/65 mt-1">{% trans "Select items in the picker; totals update live." %}</div>
      </div>
    </div>

    {# ===== Container ===== #}
    <div class="rounded-3xl border border-[#3e2723]/10 bg-white/60 backdrop-blur shadow-[0_18px_35px_rgba(0,0,0,0.08)] overflow-hidden">
      <div class="p-6 sm:p-7">
        <div class="flex flex-col sm:flex-row sm:items-end sm:justify-between gap-3">
          <div>
            <div class="text-2xl sm:text-3xl font-semibold text-[#3e2723]">{% trans "Reservation Details" %}</div>
            <div class="text-sm text-[#3e2723]/65 mt-1">
              {% trans "Choose a date & time (30-minute intervals). Pre-order is optional." %}
            </div>
          </div>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-0">
        {# LEFT: form #}
        <div class="lg:col-span-2 p-6 sm:p-7 pt-0">
          <form method="post" id="reservationForm" class="space-y-5">
            {% csrf_token %}

            {% if messages %}
              <div class="space-y-2">
                {% for message in messages %}
                  <div class="rounded-xl border border-[#3e2723]/10 bg-white p-3 text-sm text-[#3e2723]">
                    {{ message }}
                  </div>
                {% endfor %}
              </div>
            {% endif %}

            {% if form.errors %}
              <div class="rounded-2xl border border-red-200 bg-red-50 p-4">
                <div class="font-semibold text-red-800 mb-1">{% trans "Please fix the errors:" %}</div>
                <div class="text-sm text-red-800">
                  {{ form.errors }}
                </div>
              </div>
            {% endif %}

            {# WHEN #}
            <div class="rounded-2xl border border-[#3e2723]/10 bg-white/70 backdrop-blur p-5 shadow-sm">
              <div class="flex items-center justify-between gap-3">
                <div class="text-lg font-semibold text-[#3e2723]">{% trans "When" %}</div>
                <div class="text-xs text-[#3e2723]/55">{% trans "30-minute slots" %}</div>
              </div>

              <div class="hidden">
                {{ form.date }}
                {{ form.time }}
              </div>

              <button type="button" id="openDateTimeModal"
                      class="w-full mt-4 px-5 py-4 rounded-2xl bg-[#3e2723] text-white font-semibold shadow-sm
                             hover:opacity-95 active:scale-[0.99] transition">
                {% trans "Open date & time picker" %}
              </button>

              <div class="mt-3 rounded-2xl border border-[#3e2723]/10 bg-white p-4">
                <div class="text-[11px] uppercase tracking-[0.28em] text-[#3e2723]/55">{% trans "Selected slot" %}</div>
                <div id="dtSelectedPreview" class="mt-1 text-lg font-semibold text-[#3e2723]">—</div>
                <div class="mt-1 text-xs text-[#3e2723]/55">{% trans "We’ll reserve a table for this exact time." %}</div>
              </div>
            </div>

            {# GUESTS #}
            <div class="rounded-2xl border border-[#3e2723]/10 bg-white/70 backdrop-blur p-5 shadow-sm">
              <div class="flex items-center justify-between gap-3">
                <div class="text-lg font-semibold text-[#3e2723]">{% trans "Guests" %}</div>
                <div class="text-xs text-[#3e2723]/55">{% trans "Per slot: 55 chairs, 2 baby seats" %}</div>
              </div>

              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4">
                <div>
                  <label class="block text-[11px] uppercase tracking-[0.28em] text-[#3e2723]/55 mb-2">
                    {% trans "Party size" %}
                  </label>
                  {{ form.party_size }}
                  <p class="text-xs text-[#3e2723]/55 mt-2">{% trans "Total chairs available per slot: 55" %}</p>
                </div>

                <div>
                  <label class="block text-[11px] uppercase tracking-[0.28em] text-[#3e2723]/55 mb-2">
                    {% trans "Baby seats" %}
                  </label>
                  {{ form.baby_seats }}
                  <p class="text-xs text-[#3e2723]/55 mt-2">{% trans "Baby seats available per slot: 2" %}</p>
                </div>
              </div>
            </div>

            {# CUSTOMER INFO #}
            <div class="rounded-2xl border border-[#3e2723]/10 bg-white/70 backdrop-blur p-5 shadow-sm">
              <div class="text-lg font-semibold text-[#3e2723]">{% trans "Customer details" %}</div>
              <div class="text-sm text-[#3e2723]/65 mt-1">{% trans "We’ll use this to confirm your reservation if needed." %}</div>

              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4">
                <div>
                  <label class="block text-[11px] uppercase tracking-[0.28em] text-[#3e2723]/55 mb-2">
                    {% trans "Full name" %}
                  </label>
                  {{ form.name }}
                </div>

                <div>
                  <label class="block text-[11px] uppercase tracking-[0.28em] text-[#3e2723]/55 mb-2">
                    {% trans "Phone number" %}
                  </label>
                  {{ form.phone }}
                </div>

                <div class="sm:col-span-2">
                  <label class="block text-[11px] uppercase tracking-[0.28em] text-[#3e2723]/55 mb-2">
                    {% trans "Email (optional)" %}
                  </label>
                  {{ form.email }}
                  <p class="text-xs text-[#3e2723]/55 mt-2">{% trans "Optional, but helpful for sending updates." %}</p>
                </div>
              </div>
            </div>

            {# PRE-ORDER #}
            <div class="rounded-2xl border border-[#3e2723]/10 bg-white/70 backdrop-blur p-5 shadow-sm">
              <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4">
                <div class="min-w-0">
                  <div class="text-lg font-semibold text-[#3e2723]">
                    {% trans "Pre-order Food" %} <span class="text-sm font-normal text-[#3e2723]/55">({% trans "optional" %})</span>
                  </div>
                  <div class="text-sm text-[#3e2723]/65 mt-1">
                    {% trans "Add items in the picker. Click an item to preview details." %}
                  </div>
                </div>

                <div class="flex gap-2 shrink-0">
                  <button type="button" id="openPicker"
                          class="px-5 py-3 rounded-2xl bg-[#3e2723] text-white font-semibold shadow-sm
                                 hover:opacity-95 active:scale-[0.99] transition">
                    {% trans "Open picker" %}
                  </button>

                  <button type="button" id="preorderClear"
                          class="px-5 py-3 rounded-2xl bg-white text-[#3e2723] font-semibold border border-[#3e2723]/10
                                 hover:bg-white/80 active:scale-[0.99] transition">
                    {% trans "Clear" %}
                  </button>
                </div>
              </div>

              <div class="mt-5 rounded-2xl border border-[#3e2723]/10 bg-white overflow-hidden">
                <div class="p-4 border-b border-[#3e2723]/10 bg-white/70">
                  <div class="flex items-center justify-between gap-3">
                    <div>
                      <div class="text-[11px] uppercase tracking-[0.28em] text-[#3e2723]/55">{% trans "Your items" %}</div>
                      <div class="text-sm text-[#3e2723]/70 mt-1">{% trans "Adjust quantities before confirming." %}</div>
                    </div>
                    <div class="text-sm font-semibold text-[#3e2723]">
                      € <span id="preorderTotal">0.00</span>
                    </div>
                  </div>
                </div>

                <div id="preorderEditor" class="p-4">
                  <div class="text-sm text-[#3e2723]/65">{% trans "No items selected." %}</div>
                </div>
              </div>

              <div id="preorderHiddenInputs"></div>
            </div>

            {# SUBMIT #}
            <div class="pt-2 flex flex-col sm:flex-row sm:items-center gap-3">
              <button type="submit"
                      class="w-full sm:w-auto px-7 py-4 rounded-2xl bg-[#bfa76f] text-[#2a1a14] font-semibold
                             shadow-[0_14px_30px_rgba(0,0,0,0.12)]
                             hover:brightness-95 active:scale-[0.99] transition">
                {% trans "Confirm reservation" %}
              </button>

              <div class="text-xs text-[#3e2723]/55">
                {% trans "By confirming, you agree that staff may contact you if changes are needed." %}
              </div>
            </div>

          </form>
        </div>

        {# RIGHT: summary #}
        <div class="lg:col-span-1 p-6 sm:p-7 pt-0">
          <div class="lg:sticky lg:top-6 space-y-4">
            <div class="rounded-2xl border border-[#3e2723]/10 bg-white/70 backdrop-blur shadow-sm overflow-hidden">
              <div class="p-5">
                <div class="text-xl font-semibold text-[#3e2723]">{% trans "Summary" %}</div>
              </div>

              <div class="bg-[#3e2723] text-white p-5">
                <div class="space-y-3 text-sm">
                  <div class="flex items-center justify-between gap-3">
                    <div class="text-[11px] uppercase tracking-[0.28em] text-white/60">{% trans "When" %}</div>
                    <div id="sumWhen" class="font-semibold">—</div>
                  </div>

                  <div class="flex items-center justify-between gap-3">
                    <div class="text-[11px] uppercase tracking-[0.28em] text-white/60">{% trans "Guests" %}</div>
                    <div id="sumGuests" class="font-semibold">—</div>
                  </div>

                  <div class="border-t border-white/15 pt-3 flex items-center justify-between gap-3">
                    <div class="text-[11px] uppercase tracking-[0.28em] text-white/60">{% trans "Pre-order" %}</div>
                    <div id="sumPreorder" class="font-semibold">{% trans "0 items" %}</div>
                  </div>

                  <div class="border-t border-white/15 pt-3 flex items-center justify-between gap-3">
                    <div class="text-[11px] uppercase tracking-[0.28em] text-white/60">{% trans "Total" %}</div>
                    <div class="text-lg font-semibold">€ <span id="sumTotal">0.00</span></div>
                  </div>
                </div>
              </div>

              <div class="p-5 text-sm text-[#3e2723]/65">
                {% trans "You can arrive a little early. If you pre-order, we’ll start preparing closer to your slot." %}
              </div>
            </div>

            <div class="rounded-2xl border border-[#3e2723]/10 bg-white/70 backdrop-blur p-5 shadow-sm">
              <div class="text-sm text-[#3e2723]/70">
                {% trans "Need changes? Use the contact page and mention your reservation time + phone." %}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</section>

{% include "partials/datetime_picker_modal.html" %}
<div id="pickerModal" class="fixed inset-0 z-[80] hidden" aria-hidden="true">
  <div id="pickerBackdrop" class="absolute inset-0 bg-black/60"></div>

  <!-- PANEL (Menu-page style) -->
  <div class="relative h-full w-full flex items-start sm:items-center justify-center p-0 sm:p-4">
    <div class="w-full h-full sm:h-[92dvh] sm:max-h-[92dvh] sm:max-w-7xl bg-[#f5f0e6]
                border border-[#3e2723]/10 shadow-[0_22px_60px_rgba(0,0,0,0.25)]
                overflow-hidden sm:rounded-3xl flex flex-col min-h-0">

      <!-- HEADER (clean like menu) -->
      <div class="px-4 sm:px-6 py-4 border-b border-[#3e2723]/10 bg-white/70 backdrop-blur shrink-0">
        <div class="flex items-center justify-between gap-3">
          <div class="min-w-0">
            <div class="text-xs uppercase tracking-[0.35em] text-[#3e2723]/60">{% trans "Pre-order" %}</div>
            <div class="text-lg sm:text-xl font-semibold text-[#3e2723]">{% trans "Pick your items" %}</div>
            <div class="text-xs text-[#3e2723]/55 mt-0.5">{% trans "Tap item to preview • Use −/+ to change quantity" %}</div>
          </div>

          <div class="flex items-center gap-3 shrink-0">
            <!-- keep these IDs for JS totals -->
            <div class="hidden sm:flex items-center gap-2 text-sm font-semibold text-[#3e2723]">
              <span id="pickerCartCount">{% trans "0 items" %}</span>
              <span class="text-[#3e2723]/40">•</span>
              <span>€ <span id="pickerCartTotal">0.00</span></span>
            </div>

            <button type="button" id="pickerDone"
                    class="px-4 py-2 rounded-xl bg-[#3e2723] text-white text-sm font-semibold hover:opacity-95 active:scale-[0.99] transition">
              {% trans "Done" %}
            </button>

            <button type="button" id="pickerClose"
                    class="px-4 py-2 rounded-xl bg-white text-[#3e2723] text-sm font-semibold border border-[#3e2723]/10 hover:bg-[#f5f0e6] active:scale-[0.99] transition">
              {% trans "Close" %}
            </button>
          </div>
        </div>

        <!-- SEARCH (menu style) -->
        <div class="mt-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
          <div class="relative w-full sm:w-96">
            <input id="pickerSearch" type="text" placeholder="{% trans 'Search items...' %}"
                  class="w-full rounded-2xl border border-[#3e2723]/10 bg-white px-4 py-3 text-sm outline-none
                          focus:ring-2 focus:ring-[#bfa76f]/60" />
          </div>

          <div class="hidden sm:block text-xs text-[#3e2723]/55">
            {% trans "Tip: you can leave pre-order empty and still reserve a table." %}
          </div>
        </div>
      </div>

      <!-- STICKY CATEGORY RAIL (like menu page) -->
      <div class="sticky top-0 z-[3] bg-[#f5f0e6] border-b border-[#3e2723]/10 shadow-[0_10px_18px_rgba(0,0,0,0.04)] shrink-0">
        <div class="relative px-3 sm:px-6 py-3">
          <div class="pointer-events-none absolute left-0 top-0 h-full w-10 bg-gradient-to-r from-[#f5f0e6] to-transparent"></div>
          <div class="pointer-events-none absolute right-0 top-0 h-full w-10 bg-gradient-to-l from-[#f5f0e6] to-transparent"></div>

          <div class="overflow-x-auto no-scrollbar scroll-smooth px-6 sm:px-10">
            <div class="flex gap-2.5 whitespace-nowrap items-center">

              <!-- IMPORTANT: keep data-cat + catChip/catBtn for your existing JS -->
              <button type="button"
                      data-cat="all"
                      class="catChip catBtn px-4 py-2 rounded-full border text-sm font-semibold transition
                             bg-[#3e2723] text-white border-[#3e2723] shadow-sm">
                {% trans "All" %}
              </button>

              {% for c in categories %}
                <button type="button"
                        data-cat="{{ c.id }}"
                        class="catChip catBtn px-4 py-2 rounded-full border text-sm font-semibold transition
                               bg-white text-[#3e2723] border-[#3e2723]/20 hover:bg-[#3e2723] hover:text-white">
                  {{ c.name }}
                </button>
              {% endfor %}

            </div>
          </div>
        </div>
      </div>

      <!-- BODY -->
      <div class="flex-1 min-h-0 overflow-y-auto overscroll-contain"
           data-picker-scroll
           style="-webkit-overflow-scrolling: touch;">

        <div class="px-4 sm:px-6 py-5">

          <!-- REVIEW PANEL (unchanged IDs) -->
          <div id="pickerReviewPanel"
              class="hidden mb-4 rounded-2xl border border-[#3e2723]/10 bg-white overflow-hidden">
            <div class="p-3 border-b border-[#3e2723]/10 bg-white/70 flex items-center justify-between gap-3">
              <div>
                <div class="text-[11px] uppercase tracking-[0.28em] text-[#3e2723]/55">{% trans "Selected items" %}</div>
                <div class="text-xs text-[#3e2723]/55 mt-0.5">{% trans "Review your pre-order at the top." %}</div>
              </div>
              <div class="text-sm font-semibold text-[#3e2723]">
                € <span id="pickerReviewTotal">0.00</span>
              </div>
            </div>
            <div id="pickerReviewBody" class="p-3 space-y-2"></div>
          </div>

        <!-- ITEMS (grouped like menu page, keep pickerItem + data-cat etc.) -->
<div id="pickerItems" class="space-y-8">

  {# "All" section (for search / all view) still works because cards remain .pickerItem and data-cat stays #}

  {% for c in categories %}
    <section class="pickerSection" data-section-cat="{{ c.id }}">
      <!-- Category heading (menu style) -->
      <div class="flex items-center gap-3 mb-3">
        <div class="text-lg sm:text-xl font-semibold text-[#3e2723]">{{ c.name }}</div>
        <div class="h-px flex-1 bg-[#3e2723]/10"></div>
      </div>

      <div class="grid sm:grid-cols-2 gap-4 sm:gap-5">
        {% for item in menu_items %}
          {% if item.category.id == c.id %}
            <div class="pickerItem rounded-[22px] border border-[#3e2723]/10 bg-white/90 shadow-sm overflow-hidden cursor-pointer
                        hover:shadow-md hover:-translate-y-[1px] transition"
                data-cat="{{ item.category.id }}"
                data-name="{{ item.name|lower }}"
                data-id="{{ item.id }}"
                data-price="{{ item.price }}"
                data-image="{% if item.image %}{{ item.image.url }}{% endif %}"
                data-preview-url="{% url 'restaurant:menu_item_detail' item.id %}?ctx=reservation">

              <div class="p-4 sm:p-5">
                <!-- top row -->
                <div class="flex items-start justify-between gap-3">
                  <div class="min-w-0">
                    <div class="text-base sm:text-lg font-semibold text-[#3e2723] truncate">
                      {{ item.name }}
                    </div>
                    <div class="text-xs text-[#3e2723]/55 mt-1 truncate">
                      {{ item.category.name }}
                    </div>
                  </div>

                  <div class="shrink-0 text-sm sm:text-base font-semibold text-[#3e2723]">
                    € {{ item.price }}
                  </div>
                </div>

                <!-- image + description -->
                <div class="mt-4 grid grid-cols-[96px_1fr] gap-4 items-center">
                  <div class="w-[96px] h-[76px] rounded-2xl border border-[#3e2723]/10 overflow-hidden bg-[#f5f0e6]">
                    {% if item.image %}
                      <img src="{{ item.image.url }}" alt="{{ item.name }}" class="w-full h-full object-cover">
                    {% else %}
                      <div class="w-full h-full flex items-center justify-center text-xs text-[#3e2723]/45">{% trans "No image" %}</div>
                    {% endif %}
                  </div>

                  <div class="text-xs sm:text-sm text-[#3e2723]/60 line-clamp-2">
                    {{ item.description|default:"" }}
                  </div>
                </div>

                <!-- qty row -->
                <div class="mt-5 flex items-center justify-between gap-3">
                  <div class="text-[11px] uppercase tracking-[0.28em] text-[#3e2723]/45">
                    {% trans "Qty" %}
                  </div>

                  <div class="flex items-center gap-2">
                    <button type="button"
                            class="qtyMinus w-10 h-10 rounded-full border border-[#3e2723]/15 bg-white text-[#3e2723] font-semibold
                                   hover:bg-[#f5f0e6] active:scale-[0.99] transition">−</button>

                    <input type="number" min="0" value="0"
                           class="qtyInput w-14 h-10 text-center rounded-full border border-[#3e2723]/15 bg-white text-sm outline-none"
                           aria-label="{% trans 'Quantity' %}" />

                    <button type="button"
                            class="qtyPlus w-10 h-10 rounded-full border border-[#3e2723]/15 bg-white text-[#3e2723] font-semibold
                                   hover:bg-[#f5f0e6] active:scale-[0.99] transition">+</button>
                  </div>
                </div>
              </div>
            </div>
          {% endif %}
        {% endfor %}
      </div>
    </section>
  {% endfor %}

</div>

          <div class="mt-6 sm:hidden text-xs text-[#3e2723]/55">
            {% trans "Tip: you can leave pre-order empty and still reserve a table." %}
          </div>

        </div>
      </div>

      <!-- MOBILE CART BAR (keep IDs) -->
      <div class="sm:hidden border-t border-[#3e2723]/10 bg-white/80 backdrop-blur p-3 shrink-0">
        <div class="flex items-center justify-between gap-3">
          <div class="text-sm font-semibold text-[#3e2723]">
            <span id="pickerCartCountMobile">{% trans "0 items" %}</span>
            <span class="text-[#3e2723]/40">•</span>
            € <span id="pickerCartTotalMobile">0.00</span>
          </div>

          <button type="button" id="pickerGoTop"
                  class="px-4 py-2 rounded-xl bg-[#3e2723] text-white text-sm font-semibold">
            {% trans "Review" %}
          </button>
        </div>
      </div>

    </div>
  </div>
</div>

<div id="itemModal" class="fixed inset-0 z-[95] hidden" aria-hidden="true">
  <div id="itemModalBackdrop" class="absolute inset-0 bg-black/45"></div>

  <div class="absolute inset-0 flex items-center justify-center p-3 sm:p-4">
    <div class="w-full max-w-5xl rounded-3xl bg-[#f5f0e6] border border-[#3e2723]/10 shadow-[0_22px_60px_rgba(0,0,0,0.25)] overflow-hidden h-[92dvh] max-h-[92dvh] flex flex-col">

      <div class="p-4 sm:p-5 flex items-center justify-between gap-3 border-b border-[#3e2723]/10 bg-white/60 backdrop-blur shrink-0">
        <div class="min-w-0">
          <div class="text-lg font-semibold text-[#3e2723]">{% trans "Item details" %}</div>
          <div class="text-xs text-[#3e2723]/55">{% trans "This will update your reservation pre-order." %}</div>
        </div>

        <button type="button" id="itemModalClose"
                class="px-4 py-2 rounded-2xl bg-white text-[#3e2723] text-sm font-semibold border border-[#3e2723]/10 hover:bg-white/80 active:scale-[0.99] transition">
          {% trans "Close" %}
        </button>
      </div>

      <div id="itemModalBody"
           class="flex-1 min-h-0 overflow-y-auto overscroll-contain touch-pan-y"
           style="-webkit-overflow-scrolling: touch;">
        <div class="p-6 text-sm text-[#3e2723]/70">{% trans "Loading..." %}</div>
      </div>
    </div>
  </div>
</div>

{# SUCCESS MODAL (unchanged) #}
{% if show_reservation_modal and reservation_obj %}
  <div id="reservationSuccessModal" class="fixed inset-0 z-[70]">
    <div class="absolute inset-0 bg-black/40"></div>
    <div class="absolute inset-0 flex items-center justify-center p-4">
      <div class="w-full max-w-xl rounded-3xl bg-white shadow-[0_22px_60px_rgba(0,0,0,0.25)] overflow-hidden border border-[#3e2723]/10">
        <div class="p-5 sm:p-6 bg-[#f5f0e6] border-b border-[#3e2723]/10">
          <div class="text-xl font-semibold text-[#3e2723]">{% trans "Reservation placed ✅" %}</div>
          <div class="text-sm text-[#3e2723]/65 mt-1">
            {% trans "Thanks! Here are your reservation details." %}
          </div>
        </div>

        <div class="p-5 sm:p-6 space-y-3">
          <div class="rounded-2xl border border-[#3e2723]/10 bg-[#f5f0e6] p-4">
            <div class="text-sm text-[#3e2723]/70">{% trans "Name" %}</div>
            <div class="font-semibold text-[#3e2723]">{{ reservation_obj.name }}</div>
          </div>

          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            <div class="rounded-2xl border border-[#3e2723]/10 bg-[#f5f0e6] p-4">
              <div class="text-sm text-[#3e2723]/70">{% trans "When" %}</div>
              <div class="font-semibold text-[#3e2723]">{{ reservation_obj.start_datetime }}</div>
            </div>
            <div class="rounded-2xl border border-[#3e2723]/10 bg-[#f5f0e6] p-4">
              <div class="text-sm text-[#3e2723]/70">{% trans "Guests" %}</div>
              <div class="font-semibold text-[#3e2723]">{{ reservation_obj.party_size }}</div>
            </div>
          </div>

          {% if reservation_obj.items.all %}
            <div class="rounded-2xl border border-[#3e2723]/10 bg-[#f5f0e6] p-4">
              <div class="text-sm text-[#3e2723]/70 mb-2">{% trans "Pre-order" %}</div>
              <div class="space-y-1 text-sm text-[#3e2723]">
                {% for it in reservation_obj.items.all %}
                  <div class="flex items-center justify-between gap-3">
                    <div class="font-semibold">{{ it.menu_item.name }}</div>
                    <div class="text-[#3e2723]/70">{% trans "x" %}{{ it.qty }}</div>
                  </div>
                {% endfor %}
              </div>
            </div>
          {% endif %}

          <div class="flex items-center justify-end gap-2 pt-2">
            <button type="button" id="successClose"
                    class="px-5 py-2.5 rounded-2xl bg-[#3e2723] text-white font-semibold hover:opacity-95 active:scale-[0.99] transition">
              {% trans "Close" %}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endif %}

{# ✅ bridge django URLs into JS safely #}
<script>
  window.__RES_HOME_URL__ = "{% url 'restaurant:home' %}";
</script>
{% endblock %}

{% block extra_body %}
<script src="{% static 'js/reservation.js' %}" defer></script>
{% endblock %}